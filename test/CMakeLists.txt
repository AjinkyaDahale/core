# Set up dependent libraries
set(ALL_LIBS ma mds spr parma ph crv lion)
if(ENABLE_DSP)
  set(ALL_LIBS ${ALL_LIBS} dsp)
endif()
if(ENABLE_VIZ)
  set(ALL_LIBS ${ALL_LIBS} viz)
endif()
if(ENABLE_OMEGA_H)
  set(ALL_LIBS ${ALL_LIBS} apf_omega_h)
endif()

# Set up a convenience macro to setup test exes
if(NOT IS_TESTING)
  set(MYEXCLUDE EXCLUDE_FROM_ALL)
else()
  set(MYEXCLUDE)
endif()
macro(setup_exe exename srcname)
  add_executable(${exename} ${MYEXCLUDE} ${srcname})
  target_link_libraries(${exename} ${ALL_LIBS})
  if(IS_TESTING)
    install(TARGETS ${exename} DESTINATION bin)
  endif()
endmacro(setup_exe)

# Mesh validity/statistics utilities
setup_exe(verify verify.cc)
setup_exe(describe describe.cc)
setup_exe(quality quality.cc)
setup_exe(writeVtxPtn writeVtxPtn.cc)

# Geometric model utilities
setup_exe(mdlConvert mdlConvert.c)
setup_exe(mkmodel mkmodel.cc)

# Mesh generation utilities
setup_exe(box box.cc)
setup_exe(uniform uniform.cc)
setup_exe(refine2x refine2x.cc)
setup_exe(serialize serialize.cc)
setup_exe(tetrahedronize tetrahedronize.cc)

# Mesh conversion/formatting utilities
setup_exe(from_gmsh gmsh.cc)
setup_exe(from_ansys ansys.cc)
setup_exe(from_neper neper.cc)
setup_exe(from_ugrid ugrid.cc)
setup_exe(nektar_align nektar_align.cc)
if(ENABLE_OMEGA_H)
  setup_exe(from_omega_h from_omega_h.cc)
  setup_exe(to_omega_h to_omega_h.cc)
endif()

# Mesh rendering/visualization utilities
setup_exe(render render.cc)
setup_exe(renderClass renderClass.cc)
setup_exe(render_ascii render_ascii.cc)
if(ENABLE_VIZ)
  setup_exe(viz_test viz.cc)
endif()

# Mesh partitioning utilities
setup_exe(split split.cc)
setup_exe(zsplit zsplit.cc)
setup_exe(repartition repartition.cc)
setup_exe(balance balance.cc)
setup_exe(elmBalance elmBalance.cc)
setup_exe(vtxBalance vtxBalance.cc)
setup_exe(vtxElmBalance vtxElmBalance.cc)
setup_exe(vtxElmMixedBalance vtxElmMixedBalance.cc)
setup_exe(vtxEdgeElmBalance vtxEdgeElmBalance.cc)
setup_exe(ghost ghost.cc)
setup_exe(ghostMPAS ghostMPAS.cc)
setup_exe(ghostEdge ghostEdge.cc)
setup_exe(loadPart loadPart.cc)
setup_exe(ugridptnstats ugridptnstats.cc)
setup_exe(gap gap.cc)
if(ENABLE_ZOLTAN)
  setup_exe(zbalance zbalance.cc)
  setup_exe(ptnParma ptnParma.cc)
endif()
if(ENABLE_OMEGA_H)
  setup_exe(xgc_split xgc_split.cc)
endif()

# Mesh improvement utilities
setup_exe(reorder reorder.cc)
setup_exe(fixshape fixshape.cc)
setup_exe(fixlayer fixlayer.cc)
setup_exe(fixDisconnected fixDisconnected.cc)

# Phasta utilities
setup_exe(chef ../phasta/chef.cc)
setup_exe(chefReadUrPrep ../phasta/readUrPrep.cc)
setup_exe(threshold ../phasta/threshold.cc)
if(PHASTA_CHEF_ENABLED)
  setup_exe(chefStream ../phasta/chefStream.cc)
endif()

# Unit tests / functionality regression tests
setup_exe(qr qr.cc)
setup_exe(eigen_test eigen_test.cc)
setup_exe(integrate integrate.cc)
setup_exe(align align.cc)
setup_exe(field_io field_io.cc)
setup_exe(tensor tensor.cc)
setup_exe(test_AD test_AD.cc)
setup_exe(spr_test spr_test.cc)
setup_exe(reposition reposition.cc)
setup_exe(writeIPFieldTest writeIPFieldTest.cc)
setup_exe(shapefun shapefun.cc)
setup_exe(shapefun2 shapefun2.cc)
setup_exe(bezierElevation bezierElevation.cc)
setup_exe(bezierMesh bezierMesh.cc)
setup_exe(bezierMisc bezierMisc.cc)
setup_exe(bezierRefine bezierRefine.cc)
setup_exe(bezierSubdivision bezierSubdivision.cc)
setup_exe(bezierValidity bezierValidity.cc)
setup_exe(fusion fusion.cc)
setup_exe(fusion2 fusion2.cc)
setup_exe(fusion3 fusion3.cc)
setup_exe(1d 1d.cc)
setup_exe(base64 base64.cc)
setup_exe(ma_insphere ma_insphere.cc)
setup_exe(ma_test ma_test.cc)
setup_exe(prismCodeMatch ../ma/prismCodeMatch.cc)
setup_exe(pyramidCodeMatch ../ma/pyramidCodeMatch.cc)
setup_exe(newdim newdim.cc)
setup_exe(construct construct.cc)
if(ENABLE_DSP)
  setup_exe(graphdist graphdist.cc)
  setup_exe(moving moving.cc)
endif()

# Add the nightly testing script, if needed
if(IS_TESTING)
  include(testing.cmake)
endif()
